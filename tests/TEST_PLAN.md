# Test Plan — Phase 1

## Scenario — Concern Lifecycle Integration
Implement concern lifecycle mirroring, lifecycle commands, and QA enforcement gates.

## Objectives
- Validate concern logging mirrors into Markdown summaries.
- Exercise interaction stub lifecycle commands for deterministic responses.
- Confirm QA policy enforcement blocks promotions on open concerns.

## Test Strategy
- Unit tests for concern synchronization utilities.
- Integration walk-through via `make phase1-demo` (orchestrator run).
- Manual verification of pause/resume and approval gating paths.

## Environments
- Local developer workstation (Python 3.11+).
- Continuous integration pipeline (TBD) with audit artifact capture.

## Entry Criteria
- Phase 1 design and implementation plans approved by human reviewer.
- Concern lifecycle helpers available in the codebase.
- Interaction stub expanded with lifecycle commands.

## Exit Criteria
- All critical tests passing with evidence stored under `artifacts/phase1/`.
- No unresolved high/critical concerns in `audit/concerns.jsonl`.
- Approval marker recorded in documentation.

## Test Cases (Draft)
| ID | Description | Type | Expected Evidence |
| -- | ----------- | ---- | ----------------- |
| TC-101 | Sync open concerns to Markdown and verify table contents | Functional | `tests/test_concern_tools.py` pass + rendered Markdown snippet |
| TC-102 | Issue `/ack` and `/resolve` via stub, confirm audit log entries | Integration | `artifacts/phase1/demo/commands.jsonl` capture |
| TC-103 | Introduce failing QA results to trigger policy block and concern | Negative | `tests/test_policy_parser.py` extension + concern record |

_Auto-generated by Tester.prepare_phase_test_assets at 2025-11-02 04:09:04Z._

---

## Scenario — MS-02 Discovery & Blast-Radius Automation

Establish confidence in the production `codexa discover` CLI, blast-radius planner, and discovery artifact pipeline introduced for MS-02 Phase 0.

### Objectives
- Verify discovery runs honor configuration flags and produce deterministic artifacts (manifest, change zones, intent map, metrics).
- Ensure blast-radius planning detects changed artifacts/zones and recommends appropriate agent scopes.
- Validate discovery run history persistence and audit handoff logging.
- Confirm CLI outputs (text/json) provide actionable summaries with coverage and radius data.

### Test Strategy
- **Unit tests** covering blast-radius diffing, hash comparisons, and history persistence.
- **CLI integration tests** invoking `python -m codexa discover` in different modes and asserting generated files + JSON payload.
- **Regression checks** to confirm follow-up reconciliation (iteration log vs gaps) remains in sync.

### Environments
- Local developer workstation with Python 3.11+.
- Future CI pipeline capturing `analysis/` and `audit/` artifacts per run (TBD).

### Entry Criteria
- `codexa discover` CLI and supporting modules committed to the repository.
- Discovery configuration (`docs/discovery/config.yaml`) present and referenced in loop plan.
- History directory (`analysis/history/`) initialised or writeable.

### Exit Criteria
- All discovery/blast-radius unit and CLI integration tests passing.
- Discovery CLI produces artifacts without errors across full/quick modes.
- Blast-radius history file updated with latest entry; audit handoff appended when enabled.
- No outstanding follow-ups recorded after test execution.

### Test Cases
| ID | Description | Type | Expected Evidence |
| -- | ----------- | ---- | ----------------- |
| TC-201 | Compute blast radius when no previous run exists (defaults to system) | Unit | `tests/test_discovery_blast_radius.py::BlastRadiusPlannerTest.test_plan_without_previous` |
| TC-202 | Detect changed zones/artifacts and recommend local/subsystem agents | Unit | `tests/test_discovery_blast_radius.py::BlastRadiusPlannerTest.test_plan_with_changes` |
| TC-203 | Persist discovery history and trim to rolling window | Unit | `tests/test_discovery_workflow.py::DiscoveryWorkflowTest.test_history_persistence` |
| TC-204 | CLI text output summarises artifacts, coverage, and blast radius | Integration | `tests/test_discovery_cli.py::DiscoveryCLITest.test_text_output` |
| TC-205 | CLI JSON output captures artifact hashes + blast radius payload | Integration | `tests/test_discovery_cli.py::DiscoveryCLITest.test_json_output` |
| TC-206 | CLI honours `--mode` override and follow-up mismatch warnings | Integration | `tests/test_discovery_cli.py::DiscoveryCLITest.test_mode_override_and_followup_warning` |

_Authored by QA — 2025-11-03T21:35Z._
